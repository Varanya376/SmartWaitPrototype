<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartWait | Restaurants</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">

  <header class="header header-flex">
    <div>
      <h1 class="app-title">SmartWait</h1>
      <p class="tagline">RECOMMENDED RESTAURANTS NEAR YOU</p>
    </div>

    <!-- Kebab Menu -->
    <div class="kebab-wrapper">
      <button id="kebabBtn">â‹®</button>
      <div id="filterMenu">
        <div class="detail-item" onclick="applySort('wait')">â± Shortest Wait</div>
        <div class="detail-item" onclick="applySort('rating')">â­ Highest Rating</div>
        <div class="detail-item" onclick="applySort('distance')">ğŸ“ Nearest</div>
        <div class="detail-item" onclick="goToSaved()">â¤ï¸ Saved Restaurants</div>
        <div class="detail-item" onclick="goToProfile()">ğŸ‘¤ Profile</div>
        <div class="detail-item logout" onclick="logout()">ğŸšª Log out</div>
      </div>
    </div>
  </header>

  <!-- Search -->
  <div class="search-container">
    <span class="search-icon">ğŸ”</span>
    <input type="text" id="searchInput" class="search-input" placeholder="Search restaurants...">
  </div>

  <!-- MAP TOGGLE -->
  <button id="toggleMapBtn" class="map-toggle-btn">Show Map</button>

  <!-- MAP -->
  <div id="mapContainer" class="map-container" style="display:none;">
    <iframe 
      src="https://www.google.com/maps?q=restaurants%20near%20London&output=embed"
      width="100%" 
      height="300" 
      style="border:0;"
      loading="lazy">
    </iframe>
  </div>

  <!-- Filters -->
  <div class="filter-chips">
    <button class="chip active" data-filter="all">All</button>
    <button class="chip" data-filter="italian">Italian</button>
    <button class="chip" data-filter="asian">Asian</button>
    <button class="chip" data-filter="american">American</button>
    <button class="chip" data-filter="mexican">Mexican</button>
  </div>

  <main class="restaurants-grid" id="restaurantsGrid"></main>

</div>

<script>
let restaurants = [
  { name:"Dishoom Covent Garden", cuisine:"Indian", category:"asian", wait:20, distance:0.4, crowd:3, rating:4.6, menuLink:"https://www.dishoom.com/menu/" },
  { name:"La Bella Italia", cuisine:"Italian", category:"italian", wait:15, distance:0.3, crowd:2, rating:4.5, menuLink:"https://www.bellaitalia.co.uk/menu" },
  { name:"Franco Manca Soho", cuisine:"Italian", category:"italian", wait:18, distance:0.5, crowd:3, rating:4.3, menuLink:"https://www.francomanca.co.uk/menu/" },
  { name:"Five Guys Leicester Sq", cuisine:"American", category:"american", wait:10, distance:0.2, crowd:1, rating:4.2, menuLink:"https://restaurants.fiveguys.co.uk/menu" },
  { name:"Shake Shack London", cuisine:"American", category:"american", wait:25, distance:0.6, crowd:3, rating:4.4, menuLink:"https://shakeshack.com/menu" },
  { name:"Sushi Samba", cuisine:"Japanese", category:"asian", wait:30, distance:0.7, crowd:4, rating:4.7, menuLink:"https://sushisamba.com/menus/" },
  { name:"Wagamama Oxford Circus", cuisine:"Asian", category:"asian", wait:12, distance:0.4, crowd:2, rating:4.3, menuLink:"https://www.wagamama.com/menu" },
  { name:"Pizza Pilgrims", cuisine:"Italian", category:"italian", wait:14, distance:0.3, crowd:2, rating:4.6, menuLink:"https://www.pizzapilgrims.co.uk/menu/" },
  { name:"Nandoâ€™s Soho", cuisine:"Portuguese", category:"american", wait:18, distance:0.6, crowd:3, rating:4.3, menuLink:"https://www.nandos.co.uk/food/menu" },
  { name:"Honest Burgers", cuisine:"American", category:"american", wait:12, distance:0.4, crowd:2, rating:4.5, menuLink:"https://www.honestburgers.co.uk/menu/" },
  { name:"Busaba Bangkok", cuisine:"Thai", category:"asian", wait:25, distance:0.7, crowd:4, rating:4.4, menuLink:"https://busaba.com/menu/" },
  { name:"Wahaca Soho", cuisine:"Mexican", category:"mexican", wait:20, distance:0.5, crowd:3, rating:4.5, menuLink:"https://www.wahaca.co.uk/menu/" },
  { name:"Alley Cats Pizza", cuisine:"Italian", category:"italian", wait:20, distance:0.5, crowd:3, rating:4.5, menuLink:"https://alleycatspizza.co.uk/menu/" }
];

localStorage.setItem("allRestaurants", JSON.stringify(restaurants));

let currentFilter = "all";
let searchQuery = "";

/* Load profile */
const userPreferences = JSON.parse(localStorage.getItem("userPreferences")) || {
  cuisines: [],
  maxWait: 60,
  maxDistance: 5
};

/* Saved restaurants */
let savedRestaurants = JSON.parse(localStorage.getItem("savedRestaurants")) || [];

function toggleSave(name){
  if(savedRestaurants.includes(name)){
    savedRestaurants = savedRestaurants.filter(n => n !== name);
  } else {
    savedRestaurants.push(name);
  }
  localStorage.setItem("savedRestaurants", JSON.stringify(savedRestaurants));
  renderRestaurants();
}

function isSaved(name){
  return savedRestaurants.includes(name);
}

/* Recommendation score */
function calculateRecommendationScore(r){
  let score = 0;

  if(userPreferences.cuisines.includes(r.category)) score += 30;

  if(r.wait <= userPreferences.maxWait) score += 25;
  else score += Math.max(0, 25 - (r.wait - userPreferences.maxWait));

  if(r.distance <= userPreferences.maxDistance) score += 20;
  else score += Math.max(0, 20 - (r.distance - userPreferences.maxDistance) * 10);

  score += (r.rating / 5) * 15;
  score += (5 - r.crowd) * 2;

  return Math.round(score);
}

function openDetails(r){
  const url = `restaurant-details.html?name=${encodeURIComponent(r.name)}
  &cuisine=${encodeURIComponent(r.cuisine)}
  &wait=${r.wait}
  &distance=${r.distance}
  &rating=${r.rating}
  &crowd=${r.crowd}
  &score=${calculateRecommendationScore(r)}
  &menuLink=${encodeURIComponent(r.menuLink)}`;
  window.location.href = url;
}

function renderRestaurants(){
  const grid = document.getElementById("restaurantsGrid");

  let filtered = restaurants.filter(r=>{
    const f = currentFilter==="all" || r.category===currentFilter;
    const s = r.name.toLowerCase().includes(searchQuery) || r.cuisine.toLowerCase().includes(searchQuery);
    return f && s;
  });

  filtered = filtered.filter(r=>{
    const cuisineMatch = userPreferences.cuisines.length === 0 || userPreferences.cuisines.includes(r.category);
    return cuisineMatch && r.wait <= userPreferences.maxWait && r.distance <= userPreferences.maxDistance;
  });

  filtered.sort((a,b)=>calculateRecommendationScore(b)-calculateRecommendationScore(a));

  grid.innerHTML = filtered.map(r=>`
    <div class="restaurant-card">

      <div style="text-align:right;">
        <button onclick="toggleSave('${r.name}')" style="background:none;border:none;font-size:1.2rem;cursor:pointer;">
          ${isSaved(r.name) ? "â¤ï¸" : "ğŸ¤"}
        </button>
      </div>

      <div onclick='openDetails(${JSON.stringify(r)})'>
        <h2 class="restaurant-name">${r.name}</h2>

        <div class="wait-badge">
          <span class="wait-time">${r.wait}</span>
          <span class="wait-label">MIN WAIT</span>
        </div>

        <div class="card-details">
          <div class="detail-item">ğŸ“ ${r.distance} miles away</div>
          <div class="detail-item">â­ Rating: ${r.rating}</div>
          <div class="detail-item">ğŸ¤– Recommendation Score: <strong>${calculateRecommendationScore(r)}%</strong></div>
        </div>
      </div>

    </div>
  `).join("");
}

document.querySelectorAll(".chip").forEach(btn=>{
  btn.addEventListener("click",()=>{
    document.querySelectorAll(".chip").forEach(c=>c.classList.remove("active"));
    btn.classList.add("active");
    currentFilter = btn.dataset.filter;
    renderRestaurants();
  });
});

document.getElementById("searchInput").addEventListener("input", e=>{
  searchQuery = e.target.value.toLowerCase();
  renderRestaurants();
});

const kebabBtn = document.getElementById("kebabBtn");
const filterMenu = document.getElementById("filterMenu");

kebabBtn.addEventListener("click", ()=>{
  filterMenu.style.display = filterMenu.style.display === "block" ? "none" : "block";
});

function applySort(type){
  if(type === "wait") restaurants.sort((a,b)=>a.wait - b.wait);
  if(type === "rating") restaurants.sort((a,b)=>b.rating - a.rating);
  if(type === "distance") restaurants.sort((a,b)=>a.distance - b.distance);
  filterMenu.style.display = "none";
  renderRestaurants();
}

function goToProfile(){
  window.location.href = "profile.html";
}

function goToSaved(){
  window.location.href = "saved.html";
}

function logout(){
  alert("You have been logged out (prototype only).");
  window.location.href = "index.html";
}

/* Map toggle */
const toggleBtn = document.getElementById("toggleMapBtn");
const mapContainer = document.getElementById("mapContainer");

toggleBtn.addEventListener("click", ()=>{
  if(mapContainer.style.display === "none"){
    mapContainer.style.display = "block";
    toggleBtn.textContent = "Hide Map";
  } else {
    mapContainer.style.display = "none";
    toggleBtn.textContent = "Show Map";
  }
});

/* Live wait simulation */
function simulateLiveWaitTimes(){
  restaurants.forEach(r=>{
    const change = Math.floor(Math.random() * 5 - 2);
    r.wait = Math.max(5, r.wait + change);
  });
  renderRestaurants();
}
setInterval(simulateLiveWaitTimes, 5000);

renderRestaurants();
</script>

</body>
</html>
