<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartWait | Restaurant Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="app-container">

  <button class="back-btn" onclick="window.location.href='home.html'">â† Back to Restaurants</button>

  <header class="header">
    <h1 class="app-title">SmartWait</h1>
    <p class="tagline">RESTAURANT DETAILS</p>
  </header>

  <div class="restaurants-grid">
    <div class="restaurant-card">

      <!-- SAVE BUTTON -->
      <div style="text-align:right;">
        <button id="saveBtn" style="background:none;border:none;font-size:1.5rem;cursor:pointer;">ğŸ¤</button>
      </div>

      <h2 class="restaurant-name" id="restaurantName"></h2>
      <p class="cuisine-type" id="restaurantCuisine"></p>

      <p class="card-description" id="restaurantDescription"></p>

      <div class="wait-badge">
        <span class="wait-time" id="waitTime"></span>
        <span class="wait-label">MIN WAIT</span>
      </div>

      <div class="card-details">
        <div class="detail-item">ğŸ“ <span id="distance"></span></div>
        <div class="detail-item">â­ Rating: <span id="rating"></span></div>
        <div class="detail-item">ğŸ¤– Recommendation Score: <span id="score"></span>%</div>

        <!-- CROWD LEVEL -->
        <div class="detail-item">
          ğŸ‘¥ Crowd Level:
          <div class="crowd-indicator" id="crowdIndicator">
            <div class="crowd-bar"></div>
            <div class="crowd-bar"></div>
            <div class="crowd-bar"></div>
            <div class="crowd-bar"></div>
            <div class="crowd-bar"></div>
          </div>
        </div>
      </div>

      <!-- MAP -->
      <div class="map-container" id="mapContainer"></div>

      <!-- BUTTON ROW -->
      <div class="button-row">
        <a id="menuBtn" class="menu-btn" target="_blank">View Full Menu</a>
        <button class="menu-btn" id="alertBtn">Enable Table Alert</button>
      </div>

      <p id="alertMsg" style="margin-top:1rem; display:none; color:#6b5d4f; text-align:center;"></p>

    </div>
  </div>

</div>

<script>
const params = new URLSearchParams(window.location.search);

const restaurant = {
  name: params.get("name"),
  cuisine: params.get("cuisine"),
  wait: parseInt(params.get("wait")),
  distance: params.get("distance") + " miles away",
  rating: params.get("rating"),
  crowd: parseInt(params.get("crowd")),
  score: params.get("score"),
  menuLink: params.get("menuLink"),
  description: "A popular London dining destination known for its authentic flavours and vibrant atmosphere."
};

/* Populate */
document.getElementById("restaurantName").textContent = restaurant.name;
document.getElementById("restaurantCuisine").textContent = restaurant.cuisine;
document.getElementById("waitTime").textContent = restaurant.wait;
document.getElementById("distance").textContent = restaurant.distance;
document.getElementById("rating").textContent = restaurant.rating;
document.getElementById("score").textContent = restaurant.score;
document.getElementById("restaurantDescription").textContent = restaurant.description;
document.getElementById("menuBtn").href = restaurant.menuLink;

/* Crowd bars */
const bars = document.querySelectorAll(".crowd-bar");
bars.forEach((bar, i) => {
  if(i < restaurant.crowd){
    bar.classList.add("active");
  }
});

/* Save restaurant */
let savedRestaurants = JSON.parse(localStorage.getItem("savedRestaurants")) || [];
const saveBtn = document.getElementById("saveBtn");

function updateSaveIcon(){
  saveBtn.textContent = savedRestaurants.includes(restaurant.name) ? "â¤ï¸" : "ğŸ¤";
}
updateSaveIcon();

saveBtn.addEventListener("click", ()=>{
  if(savedRestaurants.includes(restaurant.name)){
    savedRestaurants = savedRestaurants.filter(r => r !== restaurant.name);
  } else {
    savedRestaurants.push(restaurant.name);
  }
  localStorage.setItem("savedRestaurants", JSON.stringify(savedRestaurants));
  updateSaveIcon();
});

/* Alert button */
const alertBtn = document.getElementById("alertBtn");
const alertMsg = document.getElementById("alertMsg");

alertBtn.addEventListener("click", ()=>{
  alertMsg.style.display = "block";
  alertMsg.textContent = `âœ” You will be notified when a table becomes available at ${restaurant.name}.`;
  alertBtn.disabled = true;
});

/* Google Map */
const mapContainer = document.getElementById("mapContainer");
const query = encodeURIComponent(restaurant.name + " London");

mapContainer.innerHTML = `
  <iframe
    width="100%"
    height="250"
    style="border:0; border-radius:12px;"
    loading="lazy"
    src="https://www.google.com/maps?q=${query}&output=embed">
  </iframe>
`;
</script>

</body>
</html>
